<%= javascript_include_tag 'nicEdit' %>
<%= javascript_include_tag 'blog' %>
<%= javascript_include_tag 'friend_tag' %>

<% content_for :left do %>
  <%= render :partial => '/app_menu' %>
<% end %>

<%= render :partial => 'blog/menu' %>

<div id='errors'></div>

<div>
<% form_for :blog, :html => {:method => 'put', :id => 'blog_form'} do |f| %>
  <div class='title'>
    <%= f.label "title" %><br/>
    <%= f.text_field 'title' %>
  </div>
  <div class='content'>
    <%= f.text_area 'content' %>
  </div>
  <div class='options'>
    <%= f.label "category: " %><%= f.collection_select 'game_id', @user.games, :id, :name, {:prompt => '---'} %><br/>
    <%= f.label "privilege: "%><%= privilege_select_tag(:blog) %>
  </div>
  <div class='submit'>
    <%= button_to_function "保存", "blog_builder.update_blog(#{@blog.id});", :class => "confirm-button" %>
    <%= button_to_function "保存为草稿", "blog_builder.update_draft(#{@blog.id});", :class => "confirm-button" %>
  </div>
    <div class='tag'>
    添加和日志相关的好友<br/>
    <%= text_field_tag 'friend[login]', '' %><%= button_to_function '', :id => 'toggle_button' %>
    <div id='friend_list' style="display:none"></div>
    <div id="friend_table" class="box05" style="display:none">
      <div class="title01">
        <div class="right">
          <select name="" onchange="blog_builder.get_friends(this.value)" >
            <option value='all'>全部好友</option>
            <% current_user.games.each do |game| %>
              <option value=<%= game.id %>><%= game.name %></option>
            <% end %>
          </select>
        </div>
        <h1>选择你的好友</h1>
      </div>
      <div class="checkgroup" id='friend_names'></div>
      <div class="buttons s_clear">
        <table class="center" cellpadding="0"><tr>
          <td>
            <span class="button"><span><button onclick="" id="confirm_btn">确定</button></span></span>
          </td>
          <td>
            <span class='button'><span><button onclick="" id='cancel_btn'>取消</button></span></span>
          </td>
        </tr></table>
      </div>
    </div>
  </div>
  <div id='friend_tags'>
    <%= render :partial => 'friend_tags/tag', :collection => @blog.tags %>
  </div>
<% end %>
</div>

<% user_ids = array_or_string_for_javascript @blog.tags.map(&:tagged_user_id) %>
<%= javascript_tag "
  var blog_builder = new BlogBuilder(#{user_ids}, 'toggle_button', 'friend_login', 'friend_list', 'friend_table' );
" %>

