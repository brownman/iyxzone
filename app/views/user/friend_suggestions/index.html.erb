<% content_for :javascript_include do %>
  <%= javascript_include_merged :search %>
<% end %>

<% @games = Game.all(:order => 'pinyin ASC') %>
<%= javascript_tag "
  Iyxzone.Game.pinyins = #{array_or_string_for_javascript @games.map(&:pinyin).insert(0, '---')};
  Iyxzone.Game.infos = #{@games.to_json :only => [:id, :name]}
" %>

<% content_for :html_title, "#{current_user.login} - 寻找好友 - 17Gaming.com" %>
<% content_for :html_description, "#{current_user.login}寻找好友 - 17Gaming.com (一起游戏网)愿做网络游戏玩家的精神家园。" %>
<% content_for :html_keywords, "#{current_user.login}, 游戏活动, 17Gaming, 一起游戏, 一起游戏网, 网络游戏玩家, 游戏社区, 社交网站, 网络游戏社区" %>

<div id="canvas" class="round_r_t"><div class="round_l_t"><div class="round_r_b"><div class="round_l_b">
	<div class="round_m"><div class="round_body">
		<h1 class="app-friend">好友</h1>
    <div class="box02 canvas_int space">
			<div class="tab tab01">
				<div class="right"><%= link_to "激请好友加入" %></div>
				<ul>
					<li><span><%= link_to '好友管理', friends_url %></span></li>
					<li class='hover'><span><%= link_to '寻找好友', friend_suggestions_url %></span></li>
					<li><span><%= link_to '好友印象', friend_impressions_url %></span></li>
				</ul>
      </div>
			<div class="friend-box">
				<div class="box02 appcontent01 jl-friend-search">
					<div class='bd-bt'>
						<h3><%= link_to_function '按昵称查找', "Iyxzone.Search.toggleUserForm()" %></h3>
					<div id='search_panel'>
					<% form_tag search_users_url, :class => "formcontent", :id => 'user_form', :onsubmit => "Iyxzone.Search.searchUsers($('user_search_submit_btn')); return false;", :style => "display:none" do %>
						<div class="rows s_clear">
              <div class="fldvalue">
								<div class="textfield"><%= text_field_tag 'key', '好友名字', :onclick => "$(this).clear();" %></div>
              </div>
              <div class="fldbtn">
                <span class="button"><span><button type="submit" id="user_search_submit_btn">查找</button></span></span>
              </div>
            </div>
					<% end %>
					</div>
					</div>
					<div class='bd-bt'>
					<h3><%= link_to_function '按游戏角色查找', "Iyxzone.Search.toggleCharacterForm()" %></h3>
					<% form_tag search_characters_url, :class => "formcontent", :id => 'character_form', :onsubmit => "Iyxzone.Search.searchCharacters($('character_search_submit_btn')); return false;", :style => "display:none" do %>
            <div class="rows s_clear">
              <div class="fldid"><label for="username">游戏角色名称：</label></div>
                <div class='fldvalue'><div class='textfield'><%= text_field_tag 'key', '', :onclick => "$(this).clear();" %></div></div>
            </div>
            <div id='character_options'>
            <div class="rows s_clear">
              <div class="fldid"><%= label_tag '游戏: ' %></div>
              <div class='fldvalue'>
              <%= collection_select :game, :id, [], :id, :name, {:prompt => '---'}, {:name => 'game_id'} %>
              </div>
            </div>
            <div class="rows s_clear">
              <div class="fldid"><%= label_tag '服务区: ' %></div>
              <div class='fldvalue'>
              <%= collection_select :area, :id, [], :id, :name, {:prompt => '---'}, {:name => 'area_id'} %>
              </div>
            </div>
            <div class="rows s_clear">
              <div class="fldid"><%= label_tag '服务器: ' %></div>
              <div class='fldvalue'>
              <%= collection_select :server, :id, [], :id, :name, {:prompt => '---'}, {:name => 'server_id'} %>
              </div>
            </div>
            </div>
						<div class="rows s_clear">
						<div class='fldid'>&nbsp;</div>
            <div class="fldbtn">
              <span class="button"><span><button type="submit" id='character_search_submit_btn'>查找</button></span></span>
            </div>
						</div>
          <% end %>
				</div>
					<h3><%= link_to_function '找MSN/EMAIL联系人', "Iyxzone.Search.toggleMsnEmailForm()" %></h3>
          <div class="formcontent" id="msn_email_form" style="display:none">
						<% form_tag url_for(:controller => 'user/signup_invitations', :action => 'add_friend'), {:onsubmit => "return Iyxzone.Search.checkMsnInputs();", :id => 'msn_input_form'} do %>
              <%= hidden_field_tag 'type', 'msn' %>
              <div class="rows s_clear">
                <div class="fldid">&nbsp;</div>
                <div class="fldrd"><input name="contact" type="radio" /></div>
								<div class="fldvalue"><label for="msn">msn</label></div>
								<div class="fldrd"><input name="contact" type="radio" onclick="Iyxzone.Search.toggleEmailInput($(this))" /></div>
                <div class="fldvalue"><label for="email">email</label></div>
              </div>
              <div class="rows s_clear">
								<div class="fldid"><label for="username">msn帐号：</label></div>
                <div class="fldvalue">
									<div class="textfield"><%= text_field_tag "user_name" %></div>
                </div>
              </div>
              <div class="rows s_clear">
								<div class="fldid"><label for="password">msn密码：</label></div>
                <div class="fldvalue">
									<div class="textfield"><%= password_field_tag 'password' %></div>
								</div>
							</div>
							<span class="remind">本站不会存储您的密码，请放心使用</span>
              <div class="rows s_clear">
								<div class="fldid">&nbsp;</div>
								<div class="fldbtn"><span class="button"><span><button type="submit" id='msn_submit_btn'>查找</button></span></span></div>
              </div>
            <% end %>
            <% form_tag url_for(:controller => 'user/signup_invitations', :action => 'add_friend'), {:onsubmit => "return Iyxzone.Search.checkEmailInputs();", :id => 'email_input_form', :style => 'display:none'} do %>
              <div class="rows s_clear">
                <div class="fldid">&nbsp;</div>
                <div class="fldrd"><input name="contact" type="radio" onclick="Iyxzone.Search.toggleMsnInput($(this))" /></div>
                <div class="fldvalue"><label for="msn">msn</label></div>
                <div class="fldrd"><input name="contact" type="radio" /></div>
                <div class="fldvalue"><label for="email">email</label></div>
              </div>
              <div class="rows s_clear">
                <div class="fldid"><label>你的邮箱：</label></div>
                <div class="fldvalue">
                  <div class="textfield left w-l" style="width:200px"><%= text_field_tag 'user_name' %></div>
                  <span class="left w-l">@</span>
                  <select class="selector selector02 left" id='email_selector' style="width:100px;" name="type">
                    <option value=''>---</option>
                    <option value='gmail'>gmail.com</option>
                    <option value='sina'>sina.com.cn</option>
                    <option value='yahoo'>yahoo.com</option>
                    <option value='yahoo'>yahoo.com.cn</option>
                    <option value='netease'>netease.com</option>
                    <option value='hotmail'>hotmail.com</option>
                  </select>
                </div>
              </div>
              <div class="rows s_clear">
                <div class="fldid"><label for="password">邮箱密码：</label></div>
                <div class="fldvalue">
                  <div class="textfield"><%= password_field_tag 'password' %></div>
                </div>
              </div>
              <span class="remind">本站不会存储您的密码，请放心使用</span>
              <div class="rows s_clear">
                <div class="fldid">&nbsp;</div>
                <div class="fldbtn"><span class="button"><span><button type="submit" id='email_submit_btn'>查找</button></span></span></div>
              </div>
            <% end %>
          </div>
				</div>
				<div class="box02 appcontent01">
					<div class='d6-head s_clear'>
					<strong class='gray left'>你可能认识的人</strong>
					<span><%= link_to '更多', {:controller => 'user/friend_suggestions', :action => 'friend'}, :class => 'right' %></span>
					</div>
          <div class="d6-list s_clear rows">
						<ul id='friend_suggestions'>
							<%= render :partial => 'nicer_friend_suggestion', :collection => @friend_suggestions %>
						</ul>
          </div>
        </div>
				<% @comrade_suggestions.each do |server_id, suggestions| %>
					<% unless suggestions.count == 0 %>
						<% server = GameServer.find(server_id) %>
						<div class="box02 appcontent01">
							<div class='d6-head s_clear rows'>
								<strong class='gray left'>你在<%= server_location server %>可能认识: </strong>
								<span><%= link_to '更多', {:controller => 'user/friend_suggestions', :action => 'comrade', :server_id => server_id}, :class => 'right' %></span>
							</div>
						  <div class="d6-list s_clear rows">
						    <ul id='server_<%= server_id %>_suggestions'>
									<%= render :partial => 'comrade_suggestion', :collection => suggestions %>
						    </ul>
						  </div>
						</div>
					<% end %>
				<% end %>
      </div>
    </div>
	</div></div>
</div></div></div></div>

<%= onload_javascript_tag "
  Iyxzone.Game.infos = #{game_infos};
  Iyxzone.Game.initPinyinSelector('game_id', null, 'area_id', null, 'server_id', null, null, null, null, null, null);
" %>
