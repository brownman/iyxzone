<% content_for :html_title, "#{@user.login} - 个人主页 - 17Gaming.com" %>
<% content_for :html_description, "#{@user.login}的个人主页 - 17Gaming.com (一起游戏网)愿做网络游戏玩家的精神家园。" %>
<% content_for :html_keywords, "#{@user.login}, 17Gaming, 一起游戏, 一起游戏网, 网络游戏玩家, 游戏社区, 社交网站, 网络游戏社区" %>

<% if !@skin.default? %>
<% content_for :stylesheet_link do %>
  <%= stylesheet_link_tag "themes/#{@skin.name}/#{@skin.css}" %>
<% end %>
<% end %>

<% content_for :javascript_include do %>
  <%= javascript_include_merged :profile %>
<% end %>

<% content_for :left do %>
	<div class="mcAvatar">
	  <div class="picwrap">
			<div class="middle"><div class="middle-center"><div class="center" id='avatar'>
				<%= avatar_image @user, :size => :large, :width => '100px', :height => '112px' %>
			</div></div></div>
	  </div>
	</div>
	<div class="avatarbox">
		<%= render :partial => 'user/profiles/operations' %>
	</div>
	<div class="profile-list menu-icon-list">
		<%= render :partial => 'user/profiles/menu' %>
	</div>
<% end %>

<% content_for :right do %>
<div class="multibox">
	<div class="title">
    <% if @user == current_user %>
		<%= link_to "更多", edit_profile_url(@profile) %>
		<% end %>
    <b>游戏人物资料</b>
  </div>
  <table class="data-table jl-data-table" cellpadding='0'>
		<tr>
			<th class='name'>游戏名称</th>
      <th class='id'>玩家昵称</th>
      <th class='level'>等级</th>
    </tr>
		<% @user.characters.each do |c| %>
    <tr>
			<td class='name'><%= game_link c.game %></td>
      <td class='id'><%= c.name %></td>
      <td class='level'><%= c.level %></td>
    </tr>
		<% end %>
  </table>
</div>

<div class='multibox'>
	<div class='title' id='tag_cloud_head'>
	<% if @user == current_user %>
		<b>大家对你的印象是</b>
	<% elsif @profile.is_taggable_by? current_user %>
		<b class='space'>你对TA的印象是</b>
	<% else %>
		<b>好友印象</b>
	<% end %>
	</div>
  <div id='tag_cloud'>
  <% if @user == current_user %>
    <%= render :partial => 'user/profiles/tags/tag_cloud', :locals => {:profile => @profile} %>
  <% elsif @profile.is_taggable_by? current_user %>
    <%= render :partial => 'user/profiles/tags/profile_tag', :locals => {:profile => @profile} %>
    <% form_remote_for :tag, :url => profile_tags_url(@profile), :html => {:onsubmit=> "Iyxzone.disableButton($(tag_submit),'请等待..');"} do |f| %>
      <p class='space'>都不贴切？自己想个</p>
      <div class='textfield04 left space'><%= text_field_tag 'tag_name', ''%></div>
      <div class="fldbtn left space"><span class="button04"><span><button id='tag_submit' type="submit">评价</button></span></span></div>
    <% end %>
  <% else %>
    <%= render :partial => 'user/profiles/tags/tag_cloud', :locals => {:profile => @profile} %>
  <% end %>
  </div>
</div>

<div class="multibox rows">
  <div class="title">
    <%= facebox_link "更多", profile_viewings_url(@profile) %>
    <b>最近来访</b>
  </div>
  <div class="photolist-box">
    <ul class="collection s_clear">
      <% @profile.viewings.each do |r| %>
        <li>
          <div class="middle"><div class="middle-center"><div class="center"><a href="#"><%= avatar r.viewer, :class => 'imgbox01' %></a></div></div></div>
          <p><%= profile_link r.viewer %></p>
          <p class="btns"></p>
        </li>
      <% end %>
    </ul>
  </div>
</div>

<% unless @user == current_user %>
<div class="multibox rows">
  <div class="title">
    <%= link_to "更多", common_friends_url(:uid => @user.id) %>
    <b>共同好友</b>
  </div>
  <div class="photolist-box">
    <ul class="collection s_clear">
      <% @common_friends.each do |cf| %>
        <li>
          <div class="middle"><div class="middle-center"><div class="center"><a href="#"><%= avatar cf, :class => 'imgbox01' %></a></div></div></div>
          <p><%= profile_link cf %></p>
          <p class="btns"></p>
        </li>
      <% end %>
    </ul>
  </div>
</div>
<% end %>

<div class="multibox rows">
  <div class="title">
		<% unless @user == current_user %>
			<%= link_to "更多", other_friends_url(:uid => @user.id) %>
			<b>他的好友</b>
		<% else %>
			<%= link_to "更多", friends_url() %>
			<b>我的好友</b>
		<% end %>
  </div>
  <div class="photolist-box">
    <ul class="collection s_clear">
      <% @user.friends.sort_by{rand}[0..2].each do |u| %>
        <li>
          <div class="middle"><div class="middle-center"><div class="center"><a href="#"><%= avatar u, :class => 'imgbox01' %></a></div></div></div>
          <p><%= profile_link u %></p>
          <p class="btns"></p>
        </li>
      <% end %>
    </ul>
  </div>
</div>

<% end %>

<div class="box02 canvas_con">
	<div class='multibox'>
	<div class='tipbar space'>
	<% if @user != current_user %>
    <% if @profile.about_me.blank? %>
		  <span>这家伙很懒，什么都没说...</span>
    <% else %>
      <span><%= simple_format @profile.about_me %></span>
    <% end %>
	<% else %>
    <%= in_place_text_area @profile, :about_me, '介绍下自己?' %>
	<% end %>
	</div>
	</div>

<div class="multibox">
	<div class="title"><%=link_to '全部相册', personal_albums_url(:uid => @user.id) %><b>最近照片</b></div>
  <div class="piclist s_clear">
	<% unless @albums.blank? %>
		<% @albums.each do |album| %>
				<div class="picitem jl-picitem">
					<div class="picbox01">
						<div class="picwrap">
							<table cellpadding="0">
								<tr><td><%= album_cover album, :size => :large, :class => 'imgbox01' %></td></tr>
							</table>          
						</div>
					</div>
					<p><b><%= album_link album %></b></p>
					<% if album.uploaded_at.blank? %>
						<p><span><%= ftime album.created_at %></span> 创建</p>
					<% else %>
						<p><span><%= ftime album.uploaded_at %></span> 更新</p>
					<% end %>
      </div>	
		<% end %>	
	<% else %>
		<% if @user==current_user %>
			<div class='space'>还没更新照片赶紧去<%= link_to '弄一个', personal_albums_url(:uid => @user.id)%>吧</div>
		<% else %>
			<div class='space'>这家伙没更新照片</div>
		<% end %>
	<% end %>
	</div>
</div>

<div class="multibox">
	<div class="title"><b>最近日志</b>
    <%= link_to "全部日志", blogs_url(:uid => @user.id) %>
	</div>
	<% unless @blogs.blank? %>
	<% @blogs.each do |blog| %>
		<div class="diary-box">
			<div class="diary-header">
				<%= blog_link blog,:class=>'shine' %> <%= ftime blog.created_at %>
			</div>
			<p> <%= blog_content blog, :length => 80, :omission => '...' %> </p>
		</div>
	<% end %>
	<% else %>
		<% if @user==current_user %>
			<div class='space'>还没更新日志赶紧去<%= link_to '弄一个', new_blog_url%>吧</div>
		<% else %>
			<div class='space'>这家伙没更新日志</div>
		<% end %>
	<% end %>
</div>

<div class='multibox'>
	<div class='title'><b>新鲜事</b></div>
	<% unless @feed_deliveries.blank? %>
	<div class='feed-box'>
		<div class="home-wrap">
			<div id ='feed_list'>
			<%= render :partial => 'user/profiles/feed_deliveries', :object => @feed_deliveries %>
			</div>
			<div class="s_clear"></div>
				<div class="round04 round_r_t jl-read-more space s_clear">
          <div class="round_l_t">
            <div class="round_r_b">
              <div class="round_l_b">
                <div class="round_m">
                  <div class="round_body" id="more_feed">
										<% if @feed_deliveries.size < @first_fetch_size %>
											<div class='jl-more'>没有更多了...</div>
										<% else %>
											<%= link_to_function "更多新鲜事", "Iyxzone.Profile.Feeder.moreFeeds(#{@profile.id});", :class => "jl-more"%>
										<% end %>
                  </div>
								</div>
              </div>
            </div>
          </div>
        </div>
		</div>
	</div>
	<% end %>
</div>

<% if @profile.is_commentable_by? current_user %>
  <%= render :partial => 'user/wall_messages/wall_form', :locals => {:wall => @profile, :recipient => @profile.user} %>
<% else %>
  <div class="bookbox">
  <h3><label for="book">留言板</label>(共<%= @profile.comments_count %>条留言)</h3>
  </div>
<% end %> 
<% if @profile.is_comment_viewable_by? current_user %>
  <div class='feed-box' id='comments'>
    <%= render :partial => 'user/wall_messages/wall_messages', :locals => {:messages => @messages} %>
  </div>
<% end %>

</div>

<% unless @reply_to.nil? %>
<%= javascript_tag "Iyxzone.Wall.set('#{@reply_to.login}', #{@reply_to.id})" %>
<% end %>
