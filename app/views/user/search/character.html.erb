<% content_for :javascript_include do %>
  <%= javascript_include_merged :search %>
<% end %>

<% content_for :html_title, "#{current_user.login} - 角色名搜索 - 17Gaming.com" %>
<% content_for :html_description, "#{current_user.login} - 角色名搜索 - 17Gaming.com (一起游戏网)愿做网络游戏玩家的精神家园。" %>
<% content_for :html_keywords, "#{current_user.login}, 17Gaming, 一起游戏, 一起游戏网, 网络游戏玩家, 游戏社区, 社交网站, 网络游戏社区" %>

<div id="canvas" class="round_r_t"><div class="round_l_t"><div class="round_r_b"><div class="round_l_b">
	<div class="round_m"><div class="round_body">
		<h1 class="app-friend">好友</h1>
    <div class="box02 canvas_int">
			<div class="tab tab01">
				<div class="right"><%= link_to "激请好友加入" %></div>
				<ul>
					<li><span><%= link_to '好友管理', friends_url %></span></li>
					<li class='hover'><span><%= link_to '寻找好友', friend_suggestions_url %></span></li>
					<li><span><%= link_to '好友印象', friend_impressions_url %></span></li>
				</ul>
      </div>
			<div class='friend-box'>
				<div class="box04 friend-one-search">
					<% form_tag search_users_url, :class => "formcontent", :id => 'user_form', :style => "display:none", :onsubmit => "Iyxzone.Search.searchUsers($('user_search_submit_btn')); return false;" do %>
            <div class="rows s_clear">
              <div class="fldvalue">
                <div class="textfield"><%= text_field_tag 'key', '要搜索的用户的昵称', :onclick => "$(this).clear();" %></div>
              </div>
              <div class="fldbtn"><span class="button"><span><button type="submit" id='user_search_submit_btn'>查找</button></span></span></div>
              <div class="link"><%= link_to_function "按游戏角色查找", "Iyxzone.Search.showCharacterForm();" %></div>
            </div>
          <% end %>
					<% form_tag search_characters_url, :class => "formcontent", :id => 'character_form', :onsubmit => "Iyxzone.Search.searchCharacters($('character_search_submit_btn')); return false;" do %>
            <div class="rows s_clear">
              <div class="fldid"><label for="username">游戏角色名称：</label></div>
                <div class='fldvalue'><div class='textfield'><%= text_field_tag 'key', '', :onclick => "$(this).clear();" %></div></div>
            </div>
            <div id='character_options'>
            <div class="rows s_clear">
              <div class="fldid"><%= label_tag '游戏: ' %></div>
              <div class='fldvalue'>
              <%= collection_select :game, :id, @games, :id, :name, {:prompt => '---'}, {:name => :game_id} %>
              </div>
            </div>
            <div class="rows s_clear">
              <div class="fldid"><%= label_tag '服务区: ' %></div>
              <div class='fldvalue'>
              <%= collection_select :area, :id, @areas, :id, :name, {:prompt => '---'}, {:name => :area_id} %>
              </div>
            </div>
            <div class="rows s_clear">
              <div class="fldid"><%= label_tag '服务器: ' %></div>
              <div class='fldvalue'>
              <%= collection_select :server, :id, @servers, :id, :name, {:prompt => '---'}, {:name => :server_id} %>
              </div>
            </div>
            </div>
						<div class="rows s_clear">
						<div class='fldid'>&nbsp;</div>
						<div class="fldbtn"><span class="button"><span><button type="submit" id='character_search_submit_btn'>查找</button></span></span></div>
						<div class='link'><%= link_to_function '按用户名查找', "Iyxzone.Search.showUserForm()" %></div>
						</div>
          <% end %>
        </div>
        <div class="box02 appcontent01">
          <div class="piclist-rows cmt-space">
            <table cellspacing='0' cellpadding='0'>
              <% @users.each do |user_id, characters| %>
              <% f = User.find(user_id) %>
              <tr>
                <td>
									<div class='imgwrap'>
										<%= avatar f, :size => :medium, :class=>'imgbox01' %>
									</div>
									<div class='data jl-data'>
										<p><%= profile_link f %></p>
										<% characters[0..2].each{ |character| %>
											<p><%= character.game.name %>,
											<%= character.server.name unless character.server.nil? %>的
											<%= character.name %></p>
											<% } %>
										<p class="space">
											<%unless current_user == f %>
											<% unless current_user.relationship_with(f)=='friend' %>
											<%= facebox_link '', new_friend_request_url(:friend_id => f.id), :class => "friend-btn w-l" %>
											<% end %>
											<%= link_to '', new_mail_url(:recipient_ids => [f.id]), :class => "msg-btn" %>
											<% end %>
										</p>
									</div>
								</td>
              </tr>
              <% end %>
            </table>
            <div class="space s_clear">
              <%= will_paginate @users %>
            </div>
          </div>
        </div>
      </div>
    </div>
	</div></div>
</div></div></div></div>

<%= javascript_tag "
  Iyxzone.Game.pinyins = #{array_or_string_for_javascript @games.map(&:pinyin).insert(0, '---')};
  Iyxzone.Game.infos = #{@games.to_json :only => [:id, :name]}
  Iyxzone.Game.initPinyinSelector('game_id', 'area_id', 'server_id', null, null, true, null, null);
" %>

<% unless @game.blank? %>
<%= javascript_tag "
  $('game_id').value = #{@game.id};
" %>
<% end %>

