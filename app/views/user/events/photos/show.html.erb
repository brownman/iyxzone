<%= stylesheet_link_tag 'test' %>
<%= stylesheet_link_tag 'cropper' %>
<%= javascript_include_tag 'textboxlist' %>
<%= javascript_include_tag 'friend' %>
<%= javascript_include_tag 'cropper' %>
<%= javascript_include_tag 'photo' %>

<% content_for :left do %>
  <%= render :partial => '/app_menu' %>
<% end %>
  
<div class='crumb'>
<div class='left'>
<% subject = get_subject @user %>
<%= event_link @event %> -> <%= album_link @album %> -> 照片<br/>
</div>
</div>
<br/>
<div class='photo-view'>
  <div class='photo-wrap'>
    <%= image_tag @photo.public_filename, :id => "photo_#{@photo.id}" %>
  </div>
  <div class='photo-info'>
	<% if @user == current_user %>
    <%= in_place_text_field :span, @photo, :notation, true, event_photo_url(@photo), {}, {:empty_text => '点击增加照片描述', :parameter_name => 'photo[notation]', :rows => 2, :cols => 70} %>
	<% else %>
		<%= @photo.notation %>
	<% end %>
  </div>
	<div>
    <ul id='photo_tags'>
    </ul>
  </div>
</div>

<%= render :partial => 'user/photo_tags/control_panel', :locals => {:photo => @photo} %>

<div id='photo_options'>
  <%= dig_link @photo %> |
	<% if @participation and [3,4,5].include? @participation.status %>
		<%= link_to_function '标记', "tagger.start();" %> |
	<% end %>
  <% if @user == current_user %>
    <%= link_to '编辑', edit_event_photo_url(@photo), :rel => 'facebox' %> |
    <%= facebox_confirm 'x', event_photo_url(@photo), {:method => :delete, :msg => '你确定要删除这张照片吗?'} %>  
  <% end %>
</div>

<div id='photo_preview'>
  <div class='prev'>
    <% if @album.photos_count > 4 %>
      <%= link_to_function '上一张', "slide.prev();" %>
    <% end %>
  </div>
  <div class='photo-list'>
    <ul id='frames'>
    <% window_size = (@album.photos_count > 4)? 4 : @album.photos_count %>
    <% window_size.times do |i| %>
      <li></li>
    <% end %>
    </ul>
  </div>
  <div class='next'>
    <% if @album.photos_count > 4 %>
      <%= link_to_function '下一张', "slide.next();" %>
    <% end %>
  </div>
</div>

<%= render :partial => 'user/comments/comment_box', :locals => {:commentable => @photo, :recipient => @photo.poster} %>

<% photo_ids = array_or_string_for_javascript @album.photos.map(&:id) %>
<% urls = array_or_string_for_javascript @album.photos.map {|p| p.public_filename(:small)} %>
<%= javascript_tag "
  var slide = new Iyxzone.Photo.Slide('event_photo', #{photo_ids}, #{urls}, #{window_size}, $('frames').childElements(), #{@photo.id});
  var tagger = new Iyxzone.Photo.Tagger('event_photo', #{@photo.id}, 'control_panel', 'confirm_btn', 'cancel_btn', #{@tags}, 'photo_tags', #{@user == current_user ? 1 : 0}, 'tag_content', 'toggle_button', 'friend_login', 'friend_list', 'friend_table', 'friend_items', 'game_selector', '#{form_authenticity_token}', {});
"%>
