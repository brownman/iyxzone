<%= stylesheet_link_tag 'test' %>
<%= javascript_include_tag 'textboxlist' %>
<%= javascript_include_tag 'nicEdit' %>
<%= javascript_include_tag 'video' %>
<%= javascript_include_tag 'friend' %>

<div id="canvas" class="round_r_t"><div class="round_l_t"><div class="round_r_b"><div class="round_l_b">
  <div class="round_m"><div class="round_body">
    <h1 class="app-video">视频</h1>
    <div class="box02 canvas_int">
      <div class="tab tab01">
        <div class="right"><%= link_to "新视频", new_video_url %></div>
        <ul>
          <li><span><%= link_to "热门视频", hot_videos_url(:id => current_user.id) %></span></li>
          <li><span><%= link_to "我的视频", videos_url(:id => current_user.id) %></span></li>
          <li><span><%= link_to "我的相关视频", relative_videos_url(:id => current_user.id) %></span></li>
          <li><span><%= link_to "好友的视频", friends_videos_url %>
        </ul>
      </div>
      <div>
        <%= error_messages_for :video, :header_message => '遇到以下问题，没法成功保存', :message => nil %>
        <div>
        <% form_for :video, :url => video_url(@video), :html => {:method => :put, :id => 'video_form'} do |f| %>
  <div class='title'>
    <%= f.label "title" %><br/>
    <%= f.text_field 'title' %>
  </div>
  <div class='url'>
    <%= f.label 'url' %><br/>
    <%= f.text_field 'video_url', :disabled => true, :id => 'video_url' %>
  </div>
  <div class='options'>
    <%= f.label "category: " %><%= f.collection_select 'game_id', current_user.games, :id, :name, {:prompt => '---'} %><br/>
    <%= f.label "privilege: "%><%= privilege_select_tag(:video) %>
  </div>
  <div class='submit'>
    <%= button_to_function "保存", "Iyxzone.Video.Builder.save(this)", :class => "confirm-button" %>
  </div>
  <div class='tag'>
    添加和视频相关的好友<br/>
    <%= text_field_tag 'friend[login]', '', :size => 50 %><%= button_to_function '', :id => 'toggle_button' %>
    <div id='friend_list' style="display:none"></div>
    <div id="friend_table" class="box05" style="display:none">
      <div class="title01">
        <div class="right">
          <select name="" id='game_selector' >
            <option value='all'>全部好友</option>
            <% current_user.games.each do |game| %>
              <option value=<%= game.id %>><%= game.name %></option>
            <% end %>
          </select>
        </div>
        <h1>选择你的好友</h1>
      </div>
      <div class="checkgroup" id='friend_items'></div>
      <div class="buttons s_clear">
        <table class="center" cellpadding="0"><tr>
          <td>
            <span class="button"><span><button onclick="" id="confirm_btn">确定</button></span></span>
          </td>
          <td>
            <span class='button'><span><button onclick="" id='cancel_btn'>取消</button></span></span>
          </td>
        </tr></table>
      </div>
    </div>
  </div>
<% end %>
      </div>
    </div>
  </div></div>
</div></div></div></div>

<% tagged_user_ids = '[' + @video.tags.map(&:tagged_user_id).join(',') + ']' %>
<% tag_ids = '[' + @video.tags.map(&:id).join(',') + ']' %>
<% user_ids = '[' + @video.relative_users.map{|u| "'#{u.login}'"}.join(',') + ']' %>
<%= javascript_tag "
  Iyxzone.Video.Builder.tagBuilder = new Iyxzone.Friend.Tagger(
    #{tagged_user_ids},
    #{tag_ids}, 
    #{user_ids},
    'toggle_button', 'friend_login', 'friend_list', 'friend_table', 'friend_items', 'game_selector', 'confirm_btn', 'cancel_btn',
    #{array_or_string_for_javascript form_authenticity_token});
" %>

