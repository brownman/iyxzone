Iyxzone.Share={version:'1.0',author:['高侠鸿'],isValidURL:function(url){if(!url.match(/(http:\/\/)?([\w\-]+\.)+[\w\-]+(\/[\w\-%=&]+)?/)){return false;}else{return true;}},isVideoURL:function(url){var youkuSingle=/http:\/\/v\.youku\.com\/v_show\/id_[\w]*\=?\.html/;var youkuAlbum=/http:\/\/v\.youku\.com\/v_playlist\/[\w]*\.html/;if(url.match(youkuSingle)||url.match(youkuAlbum)){return true;}
return false;},isInsiteURL:function(url){if(url.include("www.17gaming.com")||url.include("17gaming.com")){return true;}
return false;},newShare:function(){var url=$('link').value;if(this.isInsiteURL(url)){error('站内内容请直接在站内分享，这里请分享站外内容');}else if(this.isVideoURL(url)||this.isValidURL(url)){facebox.set_width(450);facebox.loading();new Ajax.Request('/sharings/new',{method:'get',parameters:'at=shares&url='+encodeURIComponent(url),onSuccess:function(transport){facebox.reveal(transport.responseText);}.bind(this)});}else{error('非法的url地址');}}};Iyxzone.Video={version:'1.0',author:['高侠鸿'],Builder:{},play:function(videoID,videoLink){$('video_'+videoID).update(videoLink);}};Object.extend(Iyxzone.Video.Builder,{tagBuilder:null,validate:function(){if($('video_title').value==''){error('标题不能为空');return false;}
if($('video_url').value==''){error('url不能为空');return false;}
if(!$('video_url').value.include('youku')){error('现在只有youku的视频才能解析。。慢慢都会有的');return false;}
if($('video_game_id').value==''){error('游戏类别不能为空');return false;}
if($('video_title').length>=100){facebox.show_error('标题太长了，最长100个字符');return false;}
return true;},prepare:function(form){var newTags=this.tagBuilder.getNewTags();var delTags=this.tagBuilder.getDelTags();for(var i=0;i<newTags.length;i++){var el=new Element("input",{type:'hidden',value:newTags[i],id:'video[new_friend_tags][]',name:'video[new_friend_tags][]'});form.appendChild(el);}
for(var i=0;i<delTags.length;i++){var el=new Element("input",{type:'hidden',value:delTags[i],id:'video[del_friend_tags][]',name:'video[del_friend_tags][]'});form.appendChild(el);}},save:function(button,form){Iyxzone.disableButtonThree(button,'发布中..');if(this.validate()){this.prepare(form);form.submit();}else{Iyxzone.enableButtonThree(button,'保存');}},update:function(button,form){Iyxzone.disableButtonThree(button,'更新中..');if(this.validate()){this.prepare(form);form.submit();}else{Iyxzone.enableButtonThree(button,'更新');}},init:function(max,tagInfos,toggleButton,input,friendList,friendTable,friendItems,gameSelector,confirmButton,cancelButton){this.tagBuilder=new Iyxzone.Friend.Tagger(max,tagInfos,toggleButton,input,friendList,friendTable,friendItems,gameSelector,confirmButton,cancelButton);}});